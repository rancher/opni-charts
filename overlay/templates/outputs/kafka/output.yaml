{{- if .Values.kafka.enabled }}
apiVersion: logging.banzaicloud.io/v1beta1
kind: ClusterOutput
metadata:
  name: {{ .Release.Name }}-kafka
spec:
  kafka:
    brokers: {{ .Values.kafka.brokers }}
    default_topic: {{ .Values.kafka.default_topic }}
    sasl_over_ssl: {{ .Values.kafka.sasl_over_ssl }}
    scram_mechanism: {{ .Values.kafka.scram_mechanism }}
    format:
      type: json

  {{- if .Values.kakfa.username.secret_name }}
    username:
      valueFrom:
        secretKeyRef:
          name: {{ .Values.kakfa.username.secret_name }}
          key: {{ .Values.kakfa.username.key }}
  {{- end }}
  {{- if .Values.kakfa.password.secret_name }}
    password:
      valueFrom:
        secretKeyRef:
          name: {{ .Values.kakfa.password.secret_name }}
          key: {{ .Values.kakfa.password.key }}
  {{- end }}
  {{- if .Values.kakfa.ssl_ca_cert.secret_name }}
    ssl_ca_cert:
      valueFrom:
        secretKeyRef:
          name: {{ .Values.kakfa.ssl_ca_cert.secret_name }}
          key: {{ .Values.kakfa.ssl_ca_cert.key }}
  {{- end }}
  {{- if .Values.kakfa.ssl_client_cert.secret_name }}
    ssl_client_cert:
      valueFrom:
        secretKeyRef:
          name: {{ .Values.kakfa.ssl_client_cert.secret_name }}
          key: {{ .Values.kakfa.ssl_client_cert.key }}
  {{- end }}
  {{- if .Values.kakfa.ssl_client_cert_chain.secret_name }}
    ssl_client_cert_chain:
      valueFrom:
        secretKeyRef:
          name: {{ .Values.kakfa.ssl_client_cert_chain.secret_name }}
          key: {{ .Values.kakfa.ssl_client_cert_chain.key }}
  {{- end }}
  {{- if .Values.kakfa.ssl_client_cert_key.secret_name }}
    ssl_client_cert_key:
      valueFrom:
        secretKeyRef:
          name: {{ .Values.kakfa.ssl_client_cert_key.secret_name }}
          key: {{ .Values.kakfa.ssl_client_cert_key.key }}
  {{- end }}
{{- end }}
